<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="i">

	<!-- 대분류 모임 목록 조회 -->
	<select id = "big_list"
			resultType="category"
			parameterType="int"
			>
			
			select * from category
			where category_num like #{category}||'%'
	</select>

	<!-- 선택한 카테고리에 해당하는 모임만 조회 -->
	<select id="hobee_list"
			resultType="hobee"
			parameterType="int">
			select * from hobee
			where category_num like #{category}||'%'
			order by hb_write_date
	</select>
	

	<!-- 선택한 카테고리에 해당하는 모임만 조회 -->
	<select id="hobee_list_best"
			resultType="hobee"
			parameterType="int">
			select * from hobee
			where category_num like #{category}||'%'
			order by num_of_p desc
	</select>
	
	<select id="hobee_detail"
			resultType="hobee"
			parameterType="int">
		select * from hobee
		where hb_idx=#{hb_idx}	
	</select>
	
	<!-- 1:1문의 가져오기 -->
	<select id="hobee_inquiry"
			resultType = "inquiry"
			parameterType="int">
		select * from inquiries
		where hb_idx=#{hb_idx}			
		order by id desc
	</select>
	
	<!-- 예약 추가 -->
	<insert id="hobee_reserve" parameterType="kh.pr.hobee.vo.ReserveVO">
   		 INSERT INTO reserve (
       	     reserve_id,
   		     reserve_date,
        	 hb_idx,
        	 user_id,
        	 price
    	 )
    	 VALUES (
          	 seq_reserve_reserve_id.nextVal, 
       		 SYSDATE, 
        	 #{hb_idx}, 
        	 #{user_id},
        	 #{price}
    	 )
	 </insert>
	 
	 <insert id="hobee_wishlist" parameterType="kh.pr.hobee.vo.WishlistVO">
   		 INSERT INTO wishlist (
       	     wish_idx,
        	 hb_idx,
        	 user_id
    	 )
    	 VALUES (
          	 seq_wish_idx.nextVal, 
        	 #{hb_idx}, 
        	 #{user_id}
    	 )
	 </insert>
	 
	 <select id="hobee_allwish" 
	 		 resultType = "kh.pr.hobee.vo.WishlistVO"
	 		 parameterType="int">
	 	select * from wishlist
	 	where user_id=#{user_id}
	 </select>
	 
	 <delete id="hobee_deleteWishlist" parameterType = "kh.pr.hobee.vo.WishlistVO">
		delete from wishlist 
		where user_id=#{user_id} and hb_idx=#{hb_idx}
	</delete>
	
	<insert id="saveInquiry" parameterType="kh.pr.hobee.vo.InquiryVO">
    	INSERT INTO inquiries (id,hb_idx, title, content, writer, created_date)
   		VALUES (seq_inq_idx.nextVal,#{hb_idx}, #{title}, #{content}, #{writer}, sysdate)
	</insert>
	
	<!-- 특정 사용자가 특정 hb_idx를 찜했는지 확인 -->
    <select id="checkWishlist" parameterType="map" resultType="int">
        SELECT COUNT(*) FROM wishlist WHERE user_id = #{user_id} AND hb_idx = #{hb_idx}
    </select>
    
    <select id="hobeePrice" parameterType="int" resultType="int">
    	SELECT hb_price from hobee where hb_idx=#{hbidx}
    </select>
    
    <update id="headPlus" parameterType="java.util.Map">
    	UPDATE hobee
		SET num_of_p = num_of_p + #{headCount}
		where hb_idx = #{hbidx}
    </update>
    
    <select id ="userselect" parameterType="int" resultType="users">
    	select * from users
    	where user_id = #{userid}
    
    </select>
</mapper>

